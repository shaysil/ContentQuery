"use strict";
// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.
// See LICENSE in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
const os_1 = require("os");
const path = require("path");
const colors = require("colors");
const RushCommandLineParser_1 = require("../cli/RushCommandLineParser");
const RushConstants_1 = require("../logic/RushConstants");
const RushXCommandLine_1 = require("../cli/RushXCommandLine");
const CommandLineMigrationAdvisor_1 = require("../cli/CommandLineMigrationAdvisor");
/**
 * General operations for the Rush engine.
 *
 * @public
 */
class Rush {
    /**
     * This API is used by the `@microsoft/rush` front end to launch the "rush" command-line.
     * Third-party tools should not use this API.  Instead, they should execute the "rush" binary
     * and start a new NodeJS process.
     *
     * @param launcherVersion - The version of the `@microsoft/rush` wrapper used to call invoke the CLI.
     * @param isManaged - True if the tool was invoked from within a project with a rush.json file, otherwise false. We
     *  consider a project without a rush.json to be "unmanaged" and we'll print that to the command line when
     *  the tool is executed. This is mainly used for debugging purposes.
     */
    static launch(launcherVersion, isManaged) {
        Rush._printStartupBanner(isManaged);
        if (!CommandLineMigrationAdvisor_1.CommandLineMigrationAdvisor.checkArgv(process.argv)) {
            // The migration advisor recognized an obsolete command-line
            process.exitCode = 1;
            return;
        }
        const parser = new RushCommandLineParser_1.RushCommandLineParser();
        parser.execute();
    }
    /**
     * This API is used by the `@microsoft/rush` front end to launch the "rushx" command-line.
     * Third-party tools should not use this API.  Instead, they should execute the "rushx" binary
     * and start a new NodeJS process.
     *
     * @param launcherVersion - The version of the `@microsoft/rush` wrapper used to call invoke the CLI.
     * @param isManaged - True if the tool was invoked from within a project with a rush.json file, otherwise false. We
     *  consider a project without a rush.json to be "unmanaged" and we'll print that to the command line when
     *  the tool is executed. This is mainly used for debugging purposes.
     */
    static launchRushX(launcherVersion, isManaged) {
        Rush._printStartupBanner(isManaged);
        RushXCommandLine_1.RushXCommandLine.launchRushX(launcherVersion, isManaged);
    }
    /**
     * The currently executing version of the "rush-lib" library.
     * This is the same as the Rush tool version for that release.
     */
    static get version() {
        if (!Rush._version) {
            const myPackageJsonFilename = path.resolve(path.join(__dirname, '..', '..', "package.json" /* PackageJson */));
            const myPackageJson = require(myPackageJsonFilename);
            Rush._version = myPackageJson.version;
        }
        return Rush._version;
    }
    static _printStartupBanner(isManaged) {
        console.log(os_1.EOL +
            colors.bold(`Rush Multi-Project Build Tool ${Rush.version}` + colors.yellow(isManaged ? '' : ' (unmanaged)')) +
            colors.cyan(` - ${RushConstants_1.RushConstants.rushWebSiteUrl}`) +
            os_1.EOL);
    }
}
exports.Rush = Rush;
//# sourceMappingURL=Rush.js.map